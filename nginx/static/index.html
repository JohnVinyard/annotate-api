<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Annotate UI</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/timeago.js/3.0.2/timeago.min.js"
      integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI="
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script type="text/javascript" src="settings.js"></script>
    <script type="text/javascript" src="app.js"></script>
    <script type="text/javascript" src="app2.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"
      integrity="sha256-vK3UTo/8wHbaUn+dTQD0X6dzidqc5l7gczvH+Bnowwk="
      crossorigin="anonymous" />
    <link rel="stylesheet" href="style.css" />
</head>
<body >

  <template id="welcome-template">
    <section class="section">
      <div class="content has-text-centered">
        <h1>Welcome to Cochlea!</h1>
        <p>
          It looks like you don't have an account yet.  Please <router-link
            :to="{ name: 'sign-in', params: { user }}"
            v-if="!user.data">
            sign in</router-link> or <router-link
            to="/register"
            v-if="!user.data">register</router-link>!
        </p>
      </div>
    </section>
  </template>

  <template id="menu-template">
    <section class="section">
      <div class="content has-text-centered">
        <ul>
          <li>
            <router-link :to="{ name: 'users' }">Users</router-link>
          </li>
          <li>
            <router-link :to="{ name: 'annotations' }">Annotations</router-link>
          </li>
        </ul>
      </div>
    </section>
  </template>

  <template id="sign-in-template">
    <section class="section">
      <div class="container">

        <article v-if="error" class="message is-danger">
          <div class="message-body">
            You supplied invalid credentials.
          </div>
        </article>

        <!-- User Name -->
        <div class="field">
          <label class="label" for="user-name">User Name</label>
          <div class="control">
            <input class="input" type="text" id="user-name" v-model="user.name"/>
          </div>
        </div>

        <!-- Password -->
        <div class="field">
          <label class="label" for="password">Password</label>
          <div class="control">
            <input class="input" type="password" id="password" v-model="user.password"/>
          </div>
        </div>

        <!-- Submit -->
        <div class="field">
          <div class="control">
            <button
              class="button is-link"
              type="submit"
              v-on:click="signIn">Submit</button>
          </div>
        </div>

      </div>

    </<section>
  </template>

  <template id="register-template">
    <section>
      Register
    </<section>
  </template>

  <template id="user-detail-template">
    <section class="section">
      <div class="content">
        <h1>{{ userName }}</h1>
        <p>
          <a v-bind:href="infoUrl">More info</a>
        </p>
        <p>{{ aboutMe }}</p>
      </div>
    </section>
  </template>

  <template id="add-annotation-modal-template">
    <div class="modal is-active">
        <div class="modal-background"></div>
        <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Create Annotation</p>
        <button @click="close" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">

        <sound-view
          :selectable="false"
          :feature-data="slicedFeatureData"
          :audio-url="audioUrl"
          :start-seconds="modifiedStartSeconds"></sound-view>

        <div class="field">
          <label class="label" for="annotation-tags">Space-Delimited Tags</label>
          <div class="control">
            <input
              class="input"
              type="text"
              id="annotation-tags"
              v-model="rawTags"/>
          </div>
        </div>

        <div class="container">
          <div class="tags">
            <div
              v-for="tag in tags"
              class="tag is-info">{{ tag }}</div>
          </div>
        </div>

      </section>
      <footer class="modal-card-foot">
        <button
          @click="createAnnotation"
          class="button is-success">Save changes</button>
        <button @click="close" class="button">Cancel</button>
      </footer>
    </div>
  </template>

  <template id="selection-template">
    <div
      ref="container"
      class="selection-container"
      @mousedown.ctrl="startSelection"
      @mouseup.ctrl="endSelection"
      @mouseup="endAdjustments"
      v-bind:style="{
        width: width.toString() + 'px',
        pointerEvents: acceptsEvents ? 'auto' : 'none'
      }">
      <add-annotation-modal
        @confirm-annotation="confirmAnnotation"
        @modal-close="closeModal"
        :span="span()"
        :feature-data="featureData"
        :audio-url="audioUrl"
        :start-seconds="startSeconds"
        v-if="isAddingAnnotation"></add-annotation-modal>
      <div class="selection" v-bind:style="{
          left: startPixels().toString() + 'px',
          width: widthPixels().toString() + 'px',
          pointerEvents: isSelecting ? 'none' : 'auto'
        }"></div>
      <div class="selection-handle" @mousedown="adjustLeft" v-bind:style="{
          left: (startPixels() - handleWidth).toString() + 'px',
          width: handleWidth.toString() + 'px',
          pointerEvents: isSelecting ? 'none' : 'auto',
        }"></div>
      <div class="selection-handle" @mousedown="adjustRight" v-bind:style="{
          left: (startPixels() + widthPixels()).toString() + 'px',
          width: handleWidth.toString() + 'px',
          pointerEvents: isSelecting ? 'none' : 'auto',
        }"></div>
      <div
        v-if="!(isAdjusting || isSelecting)"
        @click="addAnnotation"
        class="add-annotation"
        v-bind:style="{
          left: (startPixels() + widthPixels() - 20).toString() + 'px',
      }">+</div>
    </div>
  </template>

  <template id="sound-view-template">
    <div class="sound-view-outer-container">
        <div ref="container" class="sound-view-container">
          <selection
              @save-annotation="saveAnnotation"
              v-if="selectable"
              :feature-data="featureData"
              :audio-url="audioUrl"
              :start-seconds="startSeconds"
              :width="canvasWidth"></selection>
            <canvas
              @click.exact="playAudio"
              ref="canvas"
              class="sound-view-visualization">
            </canvas>
        </div>

        <div class="sound-view-controls">
            <div class="sound-view-zoom-in" v-on:click="zoomIn">+</div>
            <div class="sound-view-zoom-out" v-on:click="zoomOut">-</div>
        </div>
    </div>
  </template>

  <template id="annotation-template">
    <div class="card" ref="container">

      <div class="card-header">

        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <router-link :to="annotation.sound">
                <h3 class="card-header-title">{{ sound ? sound.title : '' }}</h3>
              </router-link>
              <h3>{{ `${annotation.start_seconds.toFixed(2)} - ${annotation.end_seconds.toFixed(2)}` }} seconds</h3>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <p class="is-size-7">
                created {{ timeago.format(annotation.date_created) }}
              </p>
            </div>
          </div>
        </div>

      </div>

      <div class="card-content">
        <sound-view
          :sound="sound"
          :feature-data="featureData"
          :audio-url="audioUrl"
          :start-seconds="offsetSeconds()"></sound-view>
        <div class="tags">
          <div
            v-on:click="selectQuery(tag)"
            v-for="tag in annotation.tags"
            class="tag is-info">{{ tag }}</div>
        </div>

      </div>

    </div>
  </template>

  <template id="annotations-template">
    <section class="section">
      <div class="container">

        <!-- Text search -->
        <div class="section">
          <div class="container">
            <!-- Feature selection -->
            <div class="field">
                <label class="label" for="feature-selection">Feature</label>
                <div class="control">
                  <select id="feature-selection" v-model="currentFeature" @change="changeFeature">
                    <option
                      v-for="feature in allFeatures"
                      v-bind:value="feature"
                      v-bind:key="feature.id">
                      {{ feature.user_name }}
                    </option>
                  </select>
                </div>
            </div>

            <!-- User Name -->
            <div class="field">
              <label class="label" for="query">Query</label>
              <div class="control">
                <input class="input" type="text" id="query" v-model="query"/>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="field">
              <div class="control">
                <button
                  class="button is-link"
                  type="submit"
                  v-on:click="handleSubmit">Search</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Results -->
        <div class="section">
          <div class="container">
            <annotation
              @select-query="setQuery"
              v-for="annotation in annotations"
              :annotation="annotation"
              v-bind:key="annotation.id" />
          </div>
        </div>
      </div>
    </<section>
  </template>

  <template id="user-summary-template">

    <div class="card">
      <div class="card-header">
        <h3 class="card-header-title">{{ user.user_name }}</h3>
      </div>
      <div class="card-content">
        <div class="content">
          {{ user.about_me }}
        </div>
      </div>
    </div>

  </template>

  <template id="users-template">
    <div class="container">

      <!-- Text search -->
      <div class="section">
        <div class="container">
          <!-- User Name -->
          <div class="field">
            <label class="label" for="query">Query</label>
            <div class="control">
              <input class="input" type="text" id="query" v-model="query"/>
            </div>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div class="section">
        <div class="container">
          <user-summary v-for="user in users" :user="user" />
        </div>
      </div>
    </div>
  </template>


  <template id="sounds-template">
    <section class="section">
      <div class="container">
        SOUNDS!
      </div>
    </section>
  </template>

  <template id="sound-template">
    <section class="section">
      <div class="container">
        <sound-view
          :sound="sound"
          :feature-data="featureData"
          :audio-url="audioUrl"
          :start-seconds="0"></sound-view>
      </div>
    </<section>
  </template>


  <div id="app">
    <!-- Header -->
    <header class="hero is-light" id="header">
      <div class="hero-body">
          <div class="level">
            <div class="level-left">
              <router-link :to="homeLink()"><h3>Cochlea</h3></router-link>
            </div>
            <div class="level-right" v-if="user.data">
              <button
                class="button is-link"
                type="submit"
                v-on:click="logOut">Log Out</button>
            </div>
          </div>

      </div>
    </header>

    <div
      v-if="globalMessage"
      class="global-notification notification has-text-centered"
      v-bind:class="{
        'is-success': globalMessage.type === 'success',
        'is-danger': globalMessage.type === 'error'
      }">
      <button @click="clearGlobalMessage" class="delete"></button>
      {{ globalMessage.message }}
    </div>

    <!-- Main Content -->
    <section class="section" id="main-content">
      <div class="container">
        <!-- route outlet -->
        <!-- component matched by the route will render here -->
        <router-view></router-view>
      </div>
    </section>

  </div>

</body>
</html>
